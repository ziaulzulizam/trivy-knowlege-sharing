<!DOCTYPE html>
<html>
<head>
    <title>Vulnerability Assessment Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .critical { background-color: #ff4444; color: white; }
        .high { background-color: #ff8800; color: white; }
        .medium { background-color: #ffaa00; }
        .low { background-color: #88cc88; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; }
        .summary { background-color: #f9f9f9; padding: 20px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Security Vulnerability Assessment Report</h1>
    <div class="summary">
        <h2>Executive Summary</h2>
        <p><strong>Scan Target:</strong> {{ range . }}{{ .Target }}{{ end }}</p>
        <p><strong>Scan Date:</strong> {{ now.Format "2006-01-02 15:04:05" }}</p>
        <p><strong>Total Vulnerabilities:</strong> 
        {{ $critical := 0 }}{{ $high := 0 }}{{ $medium := 0 }}{{ $low := 0 }}
        {{ range . }}{{ range .Vulnerabilities }}
            {{ if eq .Severity "CRITICAL" }}{{ $critical = add $critical 1 }}{{ end }}
            {{ if eq .Severity "HIGH" }}{{ $high = add $high 1 }}{{ end }}
            {{ if eq .Severity "MEDIUM" }}{{ $medium = add $medium 1 }}{{ end }}
            {{ if eq .Severity "LOW" }}{{ $low = add $low 1 }}{{ end }}
        {{ end }}{{ end }}
        Critical: {{ $critical }}, High: {{ $high }}, Medium: {{ $medium }}, Low: {{ $low }}
        </p>
    </div>

    {{ range . }}
    <h2>{{ .Target }}</h2>
    {{ if .Vulnerabilities }}
    <table>
        <tr>
            <th>CVE ID</th>
            <th>Severity</th>
            <th>Package</th>
            <th>Installed Version</th>
            <th>Fixed Version</th>
            <th>CVSS Score</th>
            <th>Description</th>
        </tr>
        {{ range .Vulnerabilities }}
        <tr class="{{ .Severity | lower }}">
            <td><a href="{{ .PrimaryURL }}" target="_blank">{{ .VulnerabilityID }}</a></td>
            <td>{{ .Severity }}</td>
            <td>{{ .PkgName }}</td>
            <td>{{ .InstalledVersion }}</td>
            <td>{{ .FixedVersion }}</td>
            <td>{{ if .CVSS.nvd.V3Score }}{{ .CVSS.nvd.V3Score }}{{ else }}N/A{{ end }}</td>
            <td>{{ .Title }}</td>
        </tr>
        {{ end }}
    </table>
    {{ else }}
    <p>No vulnerabilities found.</p>
    {{ end }}
    {{ end }}
</body>
</html>